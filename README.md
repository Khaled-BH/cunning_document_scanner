# Cunning Document Scanner

Cunning Document Scanner is a Flutter-based document scanner application that enables you to capture images of paper documents and convert them into digital files effortlessly. This application is designed to run on Android and iOS devices with minimum API levels of 21 and 13, respectively.

## Key Features

- Fast and easy document scanning.
- Conversion of document images into digital files.
- Support for both Android and iOS platforms.
- Minimum requirements: API 21 on Android, iOS 13 on iOS.
- Limit the number of scannable files on Android.
- Allows selection of images from the gallery on Android.

### iOS 26+ Advanced Features

- **Liquid Glass UI Integration**: Fully compatible with iOS 26's new translucent Liquid Glass design system
- **RecognizeDocumentsRequest API**: Advanced document processing with Vision framework
- **Table Detection**: Automatic detection and extraction of table structures (rows, columns, cells)
- **Multi-language Support**: Text recognition in 26 languages
- **Data Detection**: Automatic extraction of emails, phone numbers, URLs, dates, and addresses
- **List Recognition**: Automatic detection and extraction of list structures
- **Structured Metadata**: JSON export of all detected document structure and data
- **Bug Fixes**: Workarounds for iOS 26 VNDocumentCameraViewController UI issues (gray bar, invisible buttons)

A state of the art document scanner with automatic cropping function.

<img src="https://user-images.githubusercontent.com/1488063/167291601-c64db2d5-78ab-4781-bc7a-afe7eb93e083.png" height ="400"  alt=""/>
<img src="https://user-images.githubusercontent.com/1488063/167291821-3b66d0bb-b636-4911-a572-d2368dc95012.jpeg" height ="400"  alt=""/>
<img src="https://user-images.githubusercontent.com/1488063/167291827-fa0ae804-1b81-4ef4-8607-3b212c3ab1c0.jpeg" height ="400"  alt=""/>

## ⚠️ IMPORTANT: iOS 13.0+ Required

**This plugin requires iOS 13.0 or newer.** If you get camera-related compilation errors like:
- `builtinultrawidecamera is only available in iOS 13 or newer`
- `builtindualwidecamera is only available in iOS 13 or newer`

See **[CAMERA_COMPATIBILITY_FIX.md](CAMERA_COMPATIBILITY_FIX.md)** for the complete fix guide.

**Quick Fix:**
1. Edit `ios/Podfile`: Set `platform :ios, '13.0'`
2. Run `cd ios && pod install && cd ..`
3. Run `flutter clean && flutter run`

## Project Setup
Follow the steps below to set up your Flutter project on Android and iOS.

### **Android**

#### Minimum Version Configuration
Ensure you meet the minimum version requirements to run the application on Android devices.
In the `android/app/build.gradle` file, verify that `minSdkVersion` is at least 21:

```gradle
android {
    ...
    defaultConfig {
        ...
        minSdkVersion 21
        ...
    }
    ...
}
```

### **iOS**
#### Minimum Version Configuration
Ensure you meet the minimum version requirements to run the application on iOS devices.

**Basic Compatibility (iOS 13+):**
In the `ios/Podfile` file, make sure the iOS platform version is at least 13.0:

```ruby
platform :ios, '13.0'
```

**iOS 26+ Advanced Features:**
To use iOS 26 advanced features (RecognizeDocumentsRequest, Liquid Glass UI), update to:

```ruby
platform :ios, '26.0'
```

Note: The plugin is backward compatible. iOS 26 features will automatically activate when running on iOS 26+ devices, while maintaining full compatibility with iOS 13-25.
#### Permission Configuration
1. Add a String property to the app's Info.plist file with the key [NSCameraUsageDescription](https://developer.apple.com/documentation/bundleresources/information_property_list/nscamerausagedescription) and the value as the description for why your app needs camera access.

   <key>NSCameraUsageDescription</key>
   <string>Camera Permission Description</string>

2. The [permission_handler](https://pub.dev/packages/permission_handler) dependency used by cunning_document_scanner use [macros](https://github.com/Baseflow/flutter-permission-handler/blob/master/permission_handler_apple/ios/Classes/PermissionHandlerEnums.h) to control whether a permission is enabled. Add the following to your `Podfile` file:

   ```ruby
   post_install do |installer|
     installer.pods_project.targets.each do |target|
       ... # Here are some configurations automatically generated by flutter

       # Start of the permission_handler configuration
       target.build_configurations.each do |config|

         # You can enable the permissions needed here. For example to enable camera
         # permission, just remove the `#` character in front so it looks like this:
         #
         # ## dart: PermissionGroup.camera
         # 'PERMISSION_CAMERA=1'
         #
         #  Preprocessor definitions can be found at: https://github.com/Baseflow/flutter-permission-handler/blob/master/permission_handler_apple/ios/Classes/PermissionHandlerEnums.h
         config.build_settings['GCC_PREPROCESSOR_DEFINITIONS'] ||= [
           '$(inherited)',

           ## dart: PermissionGroup.camera
           'PERMISSION_CAMERA=1',
         ]

       end
       # End of the permission_handler configuration
     end
   end
   ```

## How to use ?

The easiest way to get a list of images is:

```dart
   final imagesPath = await CunningDocumentScanner.getPictures();
```
### Android Specific

There are some features in Android that allow you to adjust the scanner that will be ignored in iOS:

```dart
   final imagesPath = await CunningDocumentScanner.getPictures(
      noOfPages: 1, // Limit the number of pages to 1
      isGalleryImportAllowed, // Allow the user to also pick an image from his gallery
   );
```

### iOS Specific

On iOS it is possible to configure which image format should be used to save of the document scans. Available options are PNG (default) or JPEG. In certain situations the JPEG format could drastically reduce the file size of the final scan. If you choose to use JPEG you can also specify a compression quality, where 0.0 is highest compression (lowest quality) and 1.0 (default) is the lowest compression (highest quality).

#### Basic Usage (iOS 13+)

```dart
   // Returns images in JPEG format with a compression quality of 50%.
   final imagesPath = await CunningDocumentScanner.getPictures(
      iosScannerOptions: IosScannerOptions(
         imageFormat: IosImageFormat.jpg,
         jpgCompressionQuality: 0.5,
      ),
   );
```

#### iOS 26+ Advanced Features

Enable iOS 26's RecognizeDocumentsRequest API for advanced document processing:

```dart
// Enable iOS 26 advanced features
final imagesPath = await CunningDocumentScanner.getPictures(
   iosScannerOptions: IosScannerOptions(
      imageFormat: IosImageFormat.jpg,
      jpgCompressionQuality: 0.8,
      // Enable iOS 26 RecognizeDocumentsRequest
      useRecognizeDocumentsRequest: true,
      // Support multiple languages (26 languages available)
      recognitionLanguages: ['en-US', 'es-ES', 'fr-FR', 'de-DE'],
      // Enable advanced detection features
      enableTableDetection: true,
      enableListDetection: true,
      enableDataDetection: true,
   ),
);
```

#### Get Structured Metadata (iOS 26+)

Access detected tables, data, and document structure:

```dart
// Get images with metadata
final result = await CunningDocumentScanner.getPicturesWithMetadata(
   iosScannerOptions: IosScannerOptions(
      useRecognizeDocumentsRequest: true,
      recognitionLanguages: ['en-US'],
   ),
);

if (result != null) {
   final images = result['images'] as List<String>;
   final metadata = result['metadata'] as List<Map<String, dynamic>>;

   // Access detected tables
   for (var meta in metadata) {
      print('Language: ${meta['language']}');
      print('Full text: ${meta['transcript']}');

      // Access detected tables
      final tables = meta['tables'] as List;
      for (var table in tables) {
         print('Table: ${table['rowCount']}x${table['columnCount']}');
      }

      // Access detected data (emails, phones, URLs)
      final detectedData = meta['detectedData'] as List;
      for (var data in detectedData) {
         print('${data['type']}: ${data['text']}');
      }
   }
}
```

#### Supported Languages (iOS 26+)

The RecognizeDocumentsRequest API supports 26 languages:
- English (en-US), Spanish (es-ES), French (fr-FR), German (de-DE)
- Chinese Simplified (zh-CN), Chinese Traditional (zh-TW)
- Japanese (ja-JP), Korean (ko-KR)
- Portuguese (pt-BR), Russian (ru-RU), Arabic (ar-SA)
- Hindi (hi-IN), Italian (it-IT), Dutch (nl-NL)
- And 12 more languages...

#### Liquid Glass UI Compatibility

iOS 26's Liquid Glass design is automatically applied to the document scanner interface. The plugin includes workarounds for known iOS 26 VNDocumentCameraViewController bugs:
- Fixed gray bar appearing beneath status bar
- Fixed invisible buttons due to Liquid Glass transparency
- Enhanced button contrast for better visibility
- Proper translucent material rendering

## Installation

Before you begin, make sure you have Flutter and Dart installed on your system. You can follow the [Flutter installation guide](https://flutter.dev/docs/get-started/install) for more information.

1. Clone this repository:

   ```bash
   git clone https://github.com/jachzen/cunning_document_scanner.git
   ```

2. Navigate to the project directory:

   ```bash
   cd cunning_document_scanner
   ```

3. Install dependencies:

   ```bash
   flutter pub get
   ```

4. Run the application:

   ```bash
   flutter run
   ```

## Contributions

Contributions are welcome. If you want to contribute to the development of Cunning Document Scanner, follow these steps:

1. Fork the repository.
2. Create a branch for your contribution: `git checkout -b your_feature`
3. Make your changes and commit: `git commit -m 'Add a new feature'`
4. Push the branch: `git push origin your_feature`
5. Open a pull request on GitHub.

## Issues and Support

If you encounter any issues or have questions, please open an [issue](https://github.com/jachzen/cunning_document_scanner/issues). We're here to help.

## License

This project is licensed under the MIT License. See the [LICENSE](LICENSE) file for more details.